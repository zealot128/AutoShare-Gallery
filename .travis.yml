language: ruby
sudo: false
cache: bundler

addons:
  postgresql: 9.3
  # apt:
  #   packages:
  #     - ffmpeg

rvm:
  - 2.3.1
  - 2.4.0

before_install:
  - gem install bundler


before_script:
  # ffmpeg
  - mkdir ffmpeg
  - wget "http://ffmpeg.gusari.org/static/64bit/ffmpeg.static.64bit.latest.tar.gz"
  - tar xzf ffmpeg.static.64bit.latest.tar.gz -C ffmpeg
  - export PATH=`pwd`/ffmpeg:$PATH


  - cp config/secrets.yml.example config/secrets.yml
  - mkdir tmp
  - "bundle exec rake db:create RAILS_ENV=test"
  - "bundle exec rake db:schema:load RAILS_ENV=test"
  - ffmpeg -version

script:
  - bundle exec rspec -b
  - gem install i18n-tasks && i18n-tasks health
  - gem install bundler-audit && bundle-audit update && bundle-audit

bundler_args: "--without development production"
